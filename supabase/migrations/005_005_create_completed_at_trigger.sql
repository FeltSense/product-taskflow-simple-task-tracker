CREATE OR REPLACE FUNCTION public.handle_task_completion() RETURNS TRIGGER AS $$ BEGIN IF NEW.is_completed = TRUE AND OLD.is_completed = FALSE THEN NEW.completed_at = NOW(); ELSIF NEW.is_completed = FALSE AND OLD.is_completed = TRUE THEN NEW.completed_at = NULL; END IF; RETURN NEW; END; $$ LANGUAGE plpgsql; CREATE TRIGGER trigger_tasks_completion BEFORE UPDATE ON public.tasks FOR EACH ROW EXECUTE FUNCTION public.handle_task_completion();