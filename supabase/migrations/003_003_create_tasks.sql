CREATE TYPE task_priority AS ENUM ('low', 'medium', 'high'); CREATE TYPE task_status AS ENUM ('incomplete', 'complete'); CREATE TABLE public.tasks (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE, list_id UUID NOT NULL REFERENCES public.lists(id) ON DELETE CASCADE, title TEXT NOT NULL, description TEXT, priority task_priority DEFAULT 'medium', status task_status DEFAULT 'incomplete', due_date DATE, completed_at TIMESTAMPTZ, created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW()); ALTER TABLE public.tasks ENABLE ROW LEVEL SECURITY; CREATE POLICY "Users can manage own tasks" ON public.tasks FOR ALL USING (auth.uid() = user_id); CREATE INDEX idx_tasks_user_id ON public.tasks(user_id); CREATE INDEX idx_tasks_list_id ON public.tasks(list_id); CREATE INDEX idx_tasks_status ON public.tasks(user_id, status); CREATE INDEX idx_tasks_priority ON public.tasks(user_id, priority); CREATE INDEX idx_tasks_due_date ON public.tasks(user_id, due_date) WHERE due_date IS NOT NULL; CREATE INDEX idx_tasks_search ON public.tasks USING gin(to_tsvector('english', title || ' ' || COALESCE(description, '')));