CREATE TYPE task_status AS ENUM ('pending', 'in_progress', 'completed'); CREATE TYPE task_priority AS ENUM ('low', 'medium', 'high'); CREATE TABLE public.tasks (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE, category_id UUID REFERENCES public.categories(id) ON DELETE SET NULL, title TEXT NOT NULL, description TEXT, status task_status DEFAULT 'pending', priority task_priority DEFAULT 'medium', due_date TIMESTAMPTZ, completed_at TIMESTAMPTZ, created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW()); ALTER TABLE public.tasks ENABLE ROW LEVEL SECURITY; CREATE POLICY "Users can view own tasks" ON public.tasks FOR SELECT USING (auth.uid() = user_id); CREATE POLICY "Users can insert own tasks" ON public.tasks FOR INSERT WITH CHECK (auth.uid() = user_id); CREATE POLICY "Users can update own tasks" ON public.tasks FOR UPDATE USING (auth.uid() = user_id); CREATE POLICY "Users can delete own tasks" ON public.tasks FOR DELETE USING (auth.uid() = user_id); CREATE INDEX idx_tasks_user_id ON public.tasks(user_id); CREATE INDEX idx_tasks_status ON public.tasks(user_id, status); CREATE INDEX idx_tasks_due_date ON public.tasks(user_id, due_date); CREATE INDEX idx_tasks_category_id ON public.tasks(category_id); CREATE INDEX idx_tasks_priority ON public.tasks(user_id, priority); CREATE INDEX idx_tasks_created_at ON public.tasks(user_id, created_at DESC);