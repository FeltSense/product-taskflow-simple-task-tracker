CREATE TYPE task_priority AS ENUM ('low', 'medium', 'high'); CREATE TABLE public.tasks (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), user_id UUID NOT NULL REFERENCES public.users(id) ON DELETE CASCADE, category_id UUID REFERENCES public.categories(id) ON DELETE SET NULL, title TEXT NOT NULL, description TEXT, due_date DATE, priority task_priority DEFAULT 'medium', is_completed BOOLEAN DEFAULT FALSE, completed_at TIMESTAMPTZ, created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW()); ALTER TABLE public.tasks ENABLE ROW LEVEL SECURITY; CREATE POLICY "Users can manage own tasks" ON public.tasks FOR ALL USING (auth.uid() = user_id); CREATE INDEX idx_tasks_user_id ON public.tasks(user_id); CREATE INDEX idx_tasks_category_id ON public.tasks(category_id); CREATE INDEX idx_tasks_due_date ON public.tasks(due_date); CREATE INDEX idx_tasks_priority ON public.tasks(priority); CREATE INDEX idx_tasks_completed ON public.tasks(is_completed); CREATE INDEX idx_tasks_user_completed ON public.tasks(user_id, is_completed);