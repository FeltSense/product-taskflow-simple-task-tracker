CREATE OR REPLACE FUNCTION update_task_completed_at() RETURNS TRIGGER AS $$ BEGIN IF NEW.completed = TRUE AND OLD.completed = FALSE THEN NEW.completed_at = NOW(); ELSIF NEW.completed = FALSE AND OLD.completed = TRUE THEN NEW.completed_at = NULL; END IF; RETURN NEW; END; $$ language 'plpgsql'; CREATE TRIGGER update_task_completed_at BEFORE UPDATE ON public.tasks FOR EACH ROW EXECUTE FUNCTION update_task_completed_at();